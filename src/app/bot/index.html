<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Local Chatbot Test</title>

    <!-- Inline CSS (exact as you provided) -->
    <style>
        /* Chatbot Floating Button */
        #chatbot-btn {
            font-family: Arial, sans-serif;
            font-size: 15px;
            font-weight: bold;
            transition: 0.2s ease;
        }

        #chatbot-btn:hover {
            background: #0f5ed6;
            transform: scale(1.05);
        }

        /* Chat Box */
        #chatbot-box {
            font-family: Arial, sans-serif;
        }

        /* Messages */
        #chatbot-messages {
            padding: 5px;
        }

        #chatbot-messages div {
            margin: 6px 0;
        }

        /* Input Box */
        #chatbot-input {
            outline: none;
        }

        #chatbot-input:focus {
            border-color: #1A73E8;
        }
    </style>
</head>

<body>

    <h2>Local Chatbot Test</h2>

    <!-- Inline JavaScript (FULL CODE AS-IT-IS) -->
    <script>

        // --- Create Floating Button ---
        const chatButton = document.createElement("div");
        chatButton.id = "chatbot-btn";
        chatButton.innerText = "ðŸ’¬ Chat with us";
        chatButton.style.position = "fixed";
        chatButton.style.bottom = "20px";
        chatButton.style.right = "20px";
        chatButton.style.background = "linear-gradient(135deg, #6a11cb 0%, #2575fc 100%)";
        chatButton.style.color = "#fff";
        chatButton.style.padding = "15px 25px";
        chatButton.style.borderRadius = "50px";
        chatButton.style.cursor = "pointer";
        chatButton.style.zIndex = "9999";
        chatButton.style.boxShadow = "0 6px 20px rgba(0,0,0,0.3)";
        chatButton.style.fontWeight = "bold";
        chatButton.style.fontSize = "16px";
        chatButton.style.transition = "all 0.3s ease";

        chatButton.onmouseover = () => {
            chatButton.style.transform = "scale(1.05)";
            chatButton.style.boxShadow = "0 8px 25px rgba(0,0,0,0.4)";
        };

        chatButton.onmouseout = () => {
            chatButton.style.transform = "scale(1)";
            chatButton.style.boxShadow = "0 6px 20px rgba(0,0,0,0.3)";
        };

        document.body.appendChild(chatButton);

        // --- Create Chat Box ---
        const chatBox = document.createElement("div");
        chatBox.id = "chatbot-box";
        chatBox.style.position = "fixed";
        chatBox.style.bottom = "90px";
        chatBox.style.right = "20px";
        chatBox.style.width = "380px";
        chatBox.style.height = "500px";
        chatBox.style.background = "#ffffff";
        chatBox.style.borderRadius = "12px";
        chatBox.style.border = "1px solid #ddd";
        chatBox.style.display = "none";
        chatBox.style.zIndex = "9999";
        chatBox.style.boxShadow = "0 8px 24px rgba(0,0,0,0.15)";
        chatBox.style.flexDirection = "column";
        document.body.appendChild(chatBox);

        // --- Chat Header ---
        const headerDiv = document.createElement("div");
        headerDiv.style.background = "linear-gradient(135deg, #6a11cb 0%, #2575fc 100%)";
        headerDiv.style.color = "#fff";
        headerDiv.style.padding = "15px";
        headerDiv.style.borderRadius = "12px 12px 0 0";
        headerDiv.style.fontWeight = "bold";
        headerDiv.style.fontSize = "16px";
        headerDiv.style.textAlign = "center";
        headerDiv.style.boxShadow = "0 2px 10px rgba(0,0,0,0.1)";
        headerDiv.innerHTML = "ðŸ¤– Global Tech HRMS Chat";
        chatBox.appendChild(headerDiv);

        // --- Chat Messages Area ---
        const messagesDiv = document.createElement("div");
        messagesDiv.id = "chatbot-messages";
        messagesDiv.style.flex = "1";
        messagesDiv.style.overflowY = "auto";
        messagesDiv.style.overflowX = "hidden";
        messagesDiv.style.padding = "15px";
        messagesDiv.style.fontFamily = "Arial, sans-serif";
        messagesDiv.style.fontSize = "14px";
        messagesDiv.style.lineHeight = "1.5";
        messagesDiv.style.backgroundColor = "#f9f9f9";
        messagesDiv.style.maxHeight = "380px";
        chatBox.appendChild(messagesDiv);

        // --- Input Container ---
        const inputContainer = document.createElement("div");
        inputContainer.style.padding = "10px";
        inputContainer.style.borderTop = "1px solid #ddd";
        inputContainer.style.display = "flex";
        inputContainer.style.gap = "8px";
        chatBox.appendChild(inputContainer);

        // --- Input Box ---
        const input = document.createElement("input");
        input.id = "chatbot-input";
        input.placeholder = "Ask about our HRMS...";
        input.style.flex = "1";
        input.style.padding = "10px";
        input.style.border = "1px solid #ccc";
        input.style.borderRadius = "6px";
        input.style.outline = "none";
        input.style.fontSize = "14px";
        inputContainer.appendChild(input);

        // --- Send Button ---
        const sendButton = document.createElement("button");
        sendButton.innerText = "Send âž¤";
        sendButton.style.padding = "10px 20px";
        sendButton.style.background = "linear-gradient(135deg, #6a11cb 0%, #2575fc 100%)";
        sendButton.style.color = "#fff";
        sendButton.style.border = "none";
        sendButton.style.borderRadius = "6px";
        sendButton.style.cursor = "pointer";
        sendButton.style.fontWeight = "bold";
        sendButton.style.fontSize = "14px";
        sendButton.style.transition = "all 0.2s ease";

        sendButton.onmouseover = () => {
            sendButton.style.transform = "translateY(-2px)";
            sendButton.style.boxShadow = "0 4px 8px rgba(0,0,0,0.2)";
        };

        sendButton.onmouseout = () => {
            sendButton.style.transform = "translateY(0)";
            sendButton.style.boxShadow = "none";
        };

        inputContainer.appendChild(sendButton);

        // --- Toggle Chat Window ---
        chatButton.onclick = () => {
            if (chatBox.style.display === "none") {
                chatBox.style.display = "flex";
                input.focus();
            } else {
                chatBox.style.display = "none";
            }
        };

        // --- Function to add message ---
        function addMessage(text, isUser = false) {
            const msgDiv = document.createElement("div");
            msgDiv.style.marginBottom = "12px";
            msgDiv.style.padding = "10px";
            msgDiv.style.borderRadius = "8px";
            msgDiv.style.wordWrap = "break-word";
            msgDiv.style.whiteSpace = "pre-wrap";

            if (isUser) {
                msgDiv.style.background = "#1A73E8";
                msgDiv.style.color = "#fff";
                msgDiv.style.marginLeft = "20%";
                msgDiv.style.textAlign = "right";
                msgDiv.innerHTML = `<strong>You:</strong><br>${escapeHtml(text)}`;
            } else {
                msgDiv.style.background = "#fff";
                msgDiv.style.border = "1px solid #e0e0e0";
                msgDiv.style.color = "#333";
                msgDiv.style.marginRight = "20%";
                msgDiv.innerHTML = `<strong>Bot:</strong><br>${escapeHtml(text)}`;
            }

            messagesDiv.appendChild(msgDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;

            if (!isUser) {
                addQuickActionButtons();
            }
        }

        // --- Add buttons ---
        function addQuickActionButtons() {
            const quickButtons = [
                { text: " HRMS ", query: "hrms", emoji: "ðŸ“Š" },
                { text: " Support ", query: "support", emoji: "ðŸ“ž" },
                { text: " About ", query: "about", emoji: "ðŸ¢" },
                { text: " Blogs ", query: "blogs", emoji: "ðŸ“°" }
            ];

            const buttonsContainer = document.createElement("div");
            buttonsContainer.style.display = "flex";
            buttonsContainer.style.flexWrap = "wrap";
            buttonsContainer.style.gap = "6px";
            buttonsContainer.style.marginTop = "8px";
            buttonsContainer.style.marginBottom = "12px";
            buttonsContainer.style.marginRight = "20%";

            quickButtons.forEach(button => {
                const btn = document.createElement("button");
                btn.innerHTML = `${button.emoji}${button.text}`;
                btn.style.padding = "6px 10px";
                btn.style.background = "linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%)";
                btn.style.border = "none";
                btn.style.borderRadius = "15px";
                btn.style.cursor = "pointer";
                btn.style.fontSize = "11px";
                btn.style.color = "#333";
                btn.style.fontWeight = "bold";

                btn.onclick = () => {
                    addMessage(button.text.trim(), true);
                    sendButtonMessage(button.query);
                };

                buttonsContainer.appendChild(btn);
            });

            messagesDiv.appendChild(buttonsContainer);
        }

        // HTML Escape
        function escapeHtml(text) {
            const div = document.createElement("div");
            div.textContent = text;
            return div.innerHTML;
        }

        // Send message (normal input)
        async function sendMessage() {
            const msg = input.value.trim();
            if (!msg) return;

            if (msg.toLowerCase() === "hi" || msg.toLowerCase() === "hello") {
                handleGreeting();
                input.value = "";
                return;
            }

            input.disabled = true;
            sendButton.disabled = true;

            addMessage(msg, true);
            input.value = "";

            try {
                let response = await fetch("http://127.0.0.1:8000/chat", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ message: msg })
                });

                response = await response.json();
                addMessage(response.reply, false);

            } catch (err) {
                addMessage("Sorry, I'm having trouble connecting. Please try again.", false);
            }

            input.disabled = false;
            sendButton.disabled = false;
        }

        async function sendButtonMessage(msg) {
            input.disabled = true;
            sendButton.disabled = true;

            try {
                let response = await fetch("http://127.0.0.1:8000/chat", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ message: msg })
                });

                response = await response.json();
                addMessage(response.reply, false);

            } catch (err) {
                addMessage("Sorry, I'm having trouble connecting. Please try again.", false);
            }

            input.disabled = false;
            sendButton.disabled = false;
        }

        function handleGreeting() {
            const message = "ðŸ‘‹ Hello! How can I help you today?";
            addMessage(message, false);
        }

        input.addEventListener("keypress", e => {
            if (e.key === "Enter") sendMessage();
        });

        sendButton.onclick = sendMessage;

    </script>

</body>

</html>